services:
  - docker
install:
  - echo "Iniciando Instalacão :)!"
# Script que carrega configuração de Variaveis AWS
script:
  - echo "Inicando Build e Push para o ECR!"
  - sh "./setup-pipeline-steps/ecr_credentials.sh"
after_success:
# Validacão versão do docker
  - docker --version
# Depois de validação de versão, é instalado o pacote aws-cli
  - pip install --user awscli
# Comandos ECR para autenticação em repositório, processo de tag, build e push realizados realizados do modo padrão.
  - aws ecr create-repository --repository-name guilhermerenew/python-app --image-tag-mutability IMMUTABLE --region us-west-2
  - aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin 417311404467.dkr.ecr.us-west-2.amazonaws.com
  - docker build -t guilhermerenew/python-app .
  - docker tag guilhermerenew/python-app:20201114 417311404467.dkr.ecr.us-west-2.amazonaws.com/guilhermerenew/python-app:20201114
  - docker push 417311404467.dkr.ecr.us-west-2.amazonaws.com/guilhermerenew/python-app:20201114
# Lista de imagens ativas em repositório!
  - aws ecr describe-images --repository-name guilhermerenew/python-app --region us-west-2
# Variaveis de Ambiente AWS encriptografadas!
env:
  global:
  - secure: uM4jzQAlRIhzARShgbs+nelIQIdX+64M9TbY4jzkPgeAAlW/O/4bKB2z2Wtf4BP+xiFe2wnjB9peacYMrMQNdaT9vvmUkk1yj9PiZ+7YrDzFa0tPPqoS5hj8evnRB8PNnPRFyETAN4vZnGnJlCKzQxlmugbWGPlLQlsal9AiKhJHiTye6nFCB0/jQdVSOwIxE0Rf+gStbB1XDQglJ/u4Qh9fcz7z15fi1/yebPWjOSpVT4Tx7T4rJNqk0sBByC1YJr6yunPFY4NdKOnTw0vgjy0cv2UOobzkOisn/Fgx0CVHAN/ZYRxPLl1IWPyXh3GkH26ALbH9gj0tuNkncGBGoWI/n5eIGXk7zH+PIXde6P7ODwPOIooHNzz4C+K9xr+oSpJhELyeW6N4VCf435XJ2aixosOxBUElgUumgK25NJhg4lbL59LboK8DcOH96YmMuAs1Chrt+DOqGp4Fpq//LAdDPWQSGgzwhuKZJOREQobP5tmk3U+P8MjPrnYt7aKwwav5tQoz8FNB2FeQjhwWkqdp79AYc8X9f0CbSOJOmTnEumL3aJlh6CyltKCro5pNxCqpNyhi4f06nQo/8mEPtDgemUglW06QUTXwoSv4+j7cl9pfiJjnAy4uCsAQNQS+DPrkJDZyap8oCWNfkSHZYVlpcU/oqPrmYGfGIBrgiCg=
  - secure: VhjgMWIxlOWyaqkwOvpzRNRKF1wl7Zk2frqLmwTOtZG9TBQ+Xll8UiXB1nG9F1w1q+TkzDzx2PJS9E/ugoMZnLItPzRda0jQtH0D3Mmm1/nAcatnL8Znja5AVT6ipVPpLKyejmOuIktouYmplFC84lpdJOXtKIU/xj5vEL0g3Y+7GPBwSOXrBRrZ9ILBu3a4AhIMOBEKd4Oe1c94inmna2NdiBJZmGol/o4U9FstvcMLJZaK0VFWWdQGaMtTF+MXruN7C0kQefK7b91lOofh0pr9U1kVvt2iNOZq9aCWS0WDZb5YCYsWPH++BmrfbvIENxeRPW0UNTSmpjvhLlw1Pb06bVWXiZ630fOQNuCAXzKX3Bm/KF3M3AqfeCDXy6+BRS+HphIl9i89CdmrYwqkdN+BOBAgFD2SiASdu+dJnYk0iXnydYs2/oTewBfRpaYbIwIgmYW5hVehPF6ssBHHDDuxPIKlT22C4/pOyYfFNj5A3aDukdNcGvFiQzvAYESey9w4De5mOyNwaiwgmifuc8XtO5dncPzdkAwjvCYRztrYs3CIOTKOcmLtvoZeU2DfOzZyhFzF9eyEaOIo4FGt8UVCyepCBENGb6JDs2Z2bOTgvKEMA1rhiwqXdtXflvd/Nr9iE3uAkauiVm6KpfUJgHMbd4C8MrKN8xk9tAVEUY0=
# Slack Webhook Notification 
notifications:
  slack:
    secure: HWV8LJXqFNHWQt+KXYQ7u7l0ddf0LdkQflv0JMY+OQGqOXuCIg6afncnpWp9gZ+63CpmFT3gAidRiW+UrFDUUr99WKB4C8NCiqc3YMZHk1Aow/KICYioBBUvwO6TpCXc2Z0DPisrtzK7Gfc+qt/wMJgdYwe5KmKfLw7vBnr38MNT9/dswXB4JNLqhPMLi9xr89L1yRu8DSc0kGpzwjL2aff9NZvDILQmAqt2bUoWvDNjJklC7PTAebXOmEg+Ljkbc+fZLrBDnSdmPxcUBVIraemsQMWga8TGSUv3kpR2p/t7DhNzxrMu6bmmQSdVLOninAoe81r+WBxfZ65sopwkYauO+HAEUgjur5CmQG/2ZmEUik8DzeId+DRmCpe44L6feMsstnwayHCalfTRUk6Pwu1uKsvmMYAnVPEDXXf+eAQdtCWasQZtTHkxy7rTe9VxFWaHSCqNNbFN1XyTJsIQNuWhX90kEBY3ozF1KpqV6H2FiGvXfszabDbN29a5G4cU269lkuE+eiyWEtB5Hse7f99NSPh7nV6AWzjuV4/uFMajtuXWVAaAQoPVEe6vvUim7HS9JfriADVFn0ZU9uA6//ylDP3Wa9w/6Gs1ysUuiAXy4ljpUBWarcUyzfdkQebd0tkmMH/fpWDNpBuPDYedtKYYgSIaFhDAsvdXdlv36sw=